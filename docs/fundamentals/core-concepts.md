# DDD 核心概念

领域驱动设计 (DDD) 包含一系列核心概念和术语，这些概念共同构成了DDD的理论基础。理解这些概念对于正确应用DDD至关重要。

## 领域 (Domain)

**领域**是组织所做的事情和所处的环境，包括了组织的业务活动、规则、约束和流程。

- 领域是业务问题空间，代表了组织创造价值的核心区域
- 一个领域通常会分解为若干个**子领域**
- 领域可以分为**核心领域**、**支撑子领域**和**通用子领域**

## 模型 (Model)

**模型**是对领域的抽象，它捕获领域中相关元素及其关系，以解决特定问题。

- 模型是对现实世界的简化表示
- 一个好的模型应该能够帮助我们理解领域和解决问题
- 模型应该尽量反映领域专家的心智模型

## 通用语言 (Ubiquitous Language)

**通用语言**是团队在特定限界上下文中使用的共享语言，由领域专家和开发人员共同构建。

- 通用语言消除了技术专家和领域专家之间的翻译障碍
- 术语应该被清晰定义并一致使用
- 通用语言应该在代码、文档和口头交流中保持一致
- 通用语言随着对领域理解的深入而不断演化

## 限界上下文 (Bounded Context)

**限界上下文**是模型适用的边界，在这个边界内，通用语言和特定模型是一致且有效的。

- 限界上下文有助于处理大型系统中模型的复杂性
- 同一术语在不同上下文中可能有不同的含义
- 每个限界上下文可以有自己的架构风格和技术选择
- 上下文之间通过明确定义的接口进行通信

## 上下文映射 (Context Mapping)

**上下文映射**描述了不同限界上下文之间的关系和集成模式。

- 上下文映射有助于管理系统的整体集成
- 常见的模式包括：共享内核、客户-供应商、防腐层等
- 上下文映射应该反映组织结构和团队之间的关系

## 实体 (Entity)

**实体**是具有唯一标识的对象，即使其属性发生变化，它的身份也保持不变。

- 实体由其标识定义，而不是其属性
- 实体通常表示领域中具有生命周期的概念
- 相同类型的两个实体如果ID不同则被视为不同对象

## 值对象 (Value Object)

**值对象**是没有概念上标识的对象，完全由其属性值定义。

- 值对象应该是不可变的
- 值对象通常用于描述、度量或量化事物
- 当两个值对象的所有属性相等时，它们被视为相等

## 聚合 (Aggregate)

**聚合**是一组相关对象的集合，作为数据修改的单元处理，有一个根实体（聚合根）。

- 聚合根控制对聚合内所有对象的访问
- 聚合确保业务规则和不变性在一个事务中得到维护
- 聚合之间通过引用聚合根ID（而不是直接对象引用）来维持松散耦合

## 领域事件 (Domain Event)

**领域事件**表示在领域中发生的事情，通常表示对聚合状态的重要变更。

- 领域事件允许在不同聚合和限界上下文之间进行松耦合通信
- 事件描述了已经发生的事情，通常用过去时态命名
- 事件可以触发进一步的操作和业务流程

## 领域服务 (Domain Service)

**领域服务**实现了不自然属于任何实体或值对象的领域逻辑。

- 领域服务表示领域中的操作而非事物
- 服务通常涉及多个领域对象
- 服务应该是无状态的

## 仓储 (Repository)

**仓储**为聚合提供对象存储和检索的方法，使它们看起来像内存中的集合。

- 仓储隐藏了持久化和数据访问的细节
- 每种聚合类型通常有一个对应的仓储
- 仓储支持领域模型的解耦设计

## 工厂 (Factory)

**工厂**封装了复杂对象和聚合的创建逻辑。

- 工厂确保创建的对象处于有效状态
- 工厂隐藏了创建复杂对象的细节
- 工厂可以是独立的对象或实体/聚合根中的方法

## 规格 (Specification)

**规格**封装了业务规则，用于对象评估、选择或业务验证。

- 规格可以组合形成更复杂的规则
- 规格可用于领域逻辑和查询
- 规格有助于保持业务规则的清晰表达和重用

## 领域事件溯源 (Domain Event Sourcing)

**事件溯源**是一种将对象状态变化存储为一系列领域事件的模式。

- 对象的当前状态可以通过重放事件序列重建
- 事件溯源提供了完整的审计和历史记录
- 它使得时间点查询和状态重建成为可能

## 命令查询责任分离 (CQRS)

**CQRS**将系统分为命令(写)和查询(读)两个独立模型。

- 命令模型专注于业务规则和一致性
- 查询模型专注于数据展示和报表需求
- CQRS可以提高性能、可扩展性和安全性，但也增加了复杂性

## 六边形架构 (Hexagonal Architecture)

**六边形架构**（又称端口与适配器架构）将应用程序核心与外部关注点隔离。

- 领域模型位于架构的中心
- 通过定义明确的端口与外部世界通信
- 适配器将外部技术连接到内部端口
- 这种架构促进了领域模型的测试性和可维护性

## 如何应用这些概念

这些核心概念不应孤立应用，而是作为一个整体协同工作：

1. 首先通过与领域专家合作建立**通用语言**
2. 使用**限界上下文**组织大型系统，并定义**上下文映射**
3. 在每个上下文中，识别**实体**、**值对象**和**聚合**
4. 使用**领域服务**处理跨实体的操作
5. 通过**领域事件**实现上下文间的通信
6. 使用**仓储**和**工厂**管理对象的生命周期
7. 考虑使用**CQRS**和**事件溯源**等高级模式应对复杂需求

理解和正确应用这些概念是成功实施DDD的关键。这些概念应该根据具体领域和问题进行灵活运用，而不是机械地套用。 